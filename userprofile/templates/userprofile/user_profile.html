{% extends 'base.html' %}
{% load crispy_forms_field %}
{% load static %}

{% block content %}

<section class="hero-section">
  <div class="overlay"></div>

  <div class="container position-relative z-1 pt-5">
    <div class="row g-4 align-items-start">

      <div class="col-12">
        <div class="glass-card mb-4">
          <h1 class="fw-bold mb-3">My Profile</h1>
          <p class="text-secondary">
            Manage your account settings and cheater reports.
          </p>
        </div>
      </div>

      <!-- LEFT COLUMN -->
      <div class="col-lg-4">

        <div class="glass-card mb-4">
          <h3 class="text-success mb-4">Profile Settings</h5>

            <!-- Profile Picture -->
            <div class="text-center mb-4">
              <img id="profilePicture" src="{% static 'images/nobody.jpg' %}" alt="Profile Picture" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover; border: 2px solid rgba(46, 204, 113, 0.3);">
            </div>

            <!-- Hidden File Input -->
            <input type="file" id="profilePictureInput" class="d-none" accept="image/*">

            <!-- Upload Button -->
            <button type="button" class="btn btn-success w-100 mb-3" onclick="document.getElementById('profilePictureInput').click();">
              <i class="fas fa-camera me-2"></i>Change Picture
            </button>

            <!-- Profile Form -->
            <form id="profileForm" method="POST">
              {% csrf_token %}

              <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" disabled>
                <small class="text-muted d-block mt-1">Username cannot be changed</small>
              </div>

              <!-- Save and Discard Buttons -->
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success">
                  <i class="fas fa-save me-2"></i>Save Changes
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="location.reload();">
                  <i class="fas fa-times me-2"></i>Discard Changes
                </button>
              </div>
            </form>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="glass-card">
          <h5 class="text-success mb-4">
            <i class="fas fa-flag me-2"></i>Your Cheater Reports
          </h5>

          {% if reports %}
          <div class="table-responsive">
            <table class="table table-dark table-hover">
              <thead>
                <tr>
                  <th>Player Name</th>
                  <th>Game</th>
                  <th>Status</th>
                  <th>Date Reported</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for report in reports %}
                <tr>
                  <td>{{ report.player_name }}</td>
                  <td>{{ report.game }}</td>
                  <td>
                    {% if report.status == 'pending' %}
                    <span class="badge bg-warning">Pending</span>
                    {% elif report.status == 'confirmed' %}
                    <span class="badge bg-danger">Confirmed</span>
                    {% elif report.status == 'dismissed' %}
                    <span class="badge bg-secondary">Dismissed</span>
                    {% endif %}
                  </td>
                  <td>{{ report.date_reported|date:"M d, Y" }}</td>
                  <td>
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#reportModal{{ report.id }}">
                      <i class="fas fa-eye"></i>
                    </button>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <!-- Placeholder Reports -->
          <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>No cheater reports yet. Help keep the community clean!
          </div>

          <div class="row g-3">
            {% for i in "xxx" %}
            <div class="col-12">
              <div class="glass-card p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <h6 class="text-white mb-1">SuspiciousPlayer{{ forloop.counter }}</h6>
                    <small class="text-muted">Call of Duty: Warzone</small>
                  </div>
                  <span class="badge bg-warning">Pending Review</span>
                </div>
                <p class="text-muted mb-2">Reported on: January {{ forloop.counter|add:15 }}, 2026</p>
                <p class="text-secondary mb-3">Reason: Impossible headshots, wall hacks suspected</p>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye me-1"></i>View Details
                  </button>
                  <button class="btn btn-sm btn-outline-danger">
                    <i class="fas fa-trash me-1"></i>Delete Report
                  </button>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
</section>

<!-- JavaScript for Profile Picture Upload -->
<script>
  document.getElementById('profilePictureInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        document.getElementById('profilePicture').src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
</script>

{% endblock %}